<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡å°ˆæ¥­åˆ†æç³»çµ± Pro | Professional Stock Analyzer</title>
    <meta name="description" content="å°ˆæ¥­çš„å°è‚¡æŠ€è¡“åˆ†æç³»çµ±ï¼Œæä¾› MAã€RSIã€KDã€MACD ç­‰æŠ€è¡“æŒ‡æ¨™åˆ†æï¼Œæ”¯æ´è‡ªé¸è‚¡ç®¡ç†èˆ‡æ™ºèƒ½è­¦ç¤º">
    <meta name="keywords" content="å°è‚¡,è‚¡ç¥¨åˆ†æ,æŠ€è¡“åˆ†æ,MA,RSI,KD,MACD,è‡ªé¸è‚¡">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-bg: #0f1419;
            --secondary-bg: #1a2332;
            --card-bg: #1e2936;
            --hover-bg: #2d3a4f;
            --border-color: #2d3a4f;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent-blue: #3b82f6;
            --accent-up: #10b981;
            --accent-down: #ef4444;
            --accent-yellow: #f59e0b;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.4), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans TC', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, var(--primary-bg) 0%, #1a1f2e 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--secondary-bg) 0%, var(--card-bg) 100%);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Input Section */
        .input-section {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 24px;
            background: linear-gradient(135deg, var(--accent-blue) 0%, #8b5cf6 100%);
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.95rem;
        }

        .form-input {
            width: 100%;
            padding: 12px 16px;
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: 'JetBrains Mono', monospace;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent-blue);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-family: 'Noto Sans TC', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-blue) 0%, #2563eb 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(59, 130, 246, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: var(--secondary-bg);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        .btn-secondary:hover {
            background: var(--hover-bg);
            border-color: var(--accent-blue);
        }

        .quick-btn, .market-btn {
            padding: 8px 16px;
            background: var(--secondary-bg);
            color: var(--text-secondary);
            border: 2px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .quick-btn:hover, .market-btn:hover {
            background: var(--hover-bg);
            color: var(--text-primary);
        }

        .quick-btn.active, .market-btn.active {
            background: var(--accent-blue);
            color: white;
            border-color: var(--accent-blue);
        }

        .date-info {
            margin-top: 15px;
            padding: 12px;
            background: var(--secondary-bg);
            border-radius: 8px;
            color: var(--text-secondary);
            font-size: 0.95rem;
            border-left: 4px solid var(--accent-blue);
        }

        .date-info span {
            color: var(--accent-blue);
            font-weight: 500;
        }

        /* Loading Animation */
        .loading {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            width: 60px;
            height: 60px;
            margin: 0 auto 20px;
            border: 4px solid var(--border-color);
            border-top-color: var(--accent-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.1rem;
            color: var(--text-secondary);
        }

        /* Error Message */
        .error-message {
            display: none;
            padding: 20px;
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid var(--accent-down);
            border-radius: 12px;
            color: var(--accent-down);
            margin: 20px 0;
            font-weight: 500;
        }

        /* Results Section */
        .results {
            display: none;
        }

        .results.active {
            display: block;
        }

        /* Stock Header */
        .stock-header {
            background: linear-gradient(135deg, var(--card-bg) 0%, var(--secondary-bg) 100%);
            padding: 30px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .stock-title {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .stock-name {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
        }

        .stock-code {
            font-size: 1.5rem;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
        }

        .market-tag {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .market-tag.twse {
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent-blue);
            border: 1px solid var(--accent-blue);
        }

        .market-tag.tpex {
            background: rgba(139, 92, 246, 0.2);
            color: #8b5cf6;
            border: 1px solid #8b5cf6;
        }

        .stock-date {
            color: var(--text-muted);
            font-size: 0.95rem;
        }

        .price-display {
            display: flex;
            align-items: baseline;
            gap: 15px;
            margin-top: 15px;
        }

        .current-price {
            font-size: 3rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .price-up {
            color: var(--accent-up);
        }

        .price-down {
            color: var(--accent-down);
        }

        .price-flat {
            color: var(--text-secondary);
        }

        .price-change {
            font-size: 1.2rem;
            font-weight: 500;
        }

        /* Overview Cards */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .overview-card {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .overview-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--accent-blue);
        }

        .card-title {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
            font-weight: 500;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .card-status {
            font-size: 0.9rem;
            color: var(--text-muted);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--secondary-bg);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 12px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-blue) 0%, #8b5cf6 100%);
            border-radius: 4px;
            transition: width 0.6s ease;
        }

        /* Key Levels */
        .key-levels {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .level-item {
            padding: 16px;
            background: var(--secondary-bg);
            border-radius: 8px;
            border-left: 4px solid var(--accent-blue);
        }

        .level-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .level-value {
            font-size: 1.5rem;
            font-weight: 600;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Charts */
        .chart-container {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .chart-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .chart-legend {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 16px;
            height: 3px;
            border-radius: 2px;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border-color);
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn:hover {
            color: var(--text-primary);
            background: var(--hover-bg);
        }

        .tab-btn.active {
            color: var(--accent-blue);
            border-bottom-color: var(--accent-blue);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Technical Table */
        .table-container {
            overflow-x: auto;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--secondary-bg);
        }

        th {
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 0.9rem;
            border-bottom: 2px solid var(--border-color);
        }

        td {
            padding: 14px 16px;
            border-bottom: 1px solid var(--border-color);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.95rem;
        }

        tbody tr {
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--hover-bg);
        }

        /* Alerts */
        .alerts-section {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .alerts-summary {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .alert-stat {
            padding: 12px 20px;
            background: var(--secondary-bg);
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-stat-icon {
            font-size: 1.5rem;
        }

        .alert-stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
        }

        .alert-stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .alert-item {
            padding: 16px;
            background: var(--secondary-bg);
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            border-left: 4px solid var(--accent-blue);
            transition: all 0.3s ease;
        }

        .alert-item:hover {
            background: var(--hover-bg);
            transform: translateX(4px);
        }

        .alert-item.priority-1 {
            border-left-color: var(--accent-down);
        }

        .alert-item.priority-2 {
            border-left-color: var(--accent-yellow);
        }

        .alert-item.priority-3 {
            border-left-color: var(--accent-blue);
        }

        .alert-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .alert-content {
            flex: 1;
        }

        .alert-title {
            font-weight: 600;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .alert-desc {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .alert-tag {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
            flex-shrink: 0;
        }

        .tag-bullish {
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent-up);
            border: 1px solid var(--accent-up);
        }

        .tag-bearish {
            background: rgba(239, 68, 68, 0.2);
            color: var(--accent-down);
            border: 1px solid var(--accent-down);
        }

        .tag-warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--accent-yellow);
            border: 1px solid var(--accent-yellow);
        }

        .tag-neutral {
            background: rgba(100, 116, 139, 0.2);
            color: var(--text-muted);
            border: 1px solid var(--text-muted);
        }

        /* AI Report */
        .ai-report {
            background: linear-gradient(135deg, var(--card-bg) 0%, var(--secondary-bg) 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .report-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .report-content {
            line-height: 1.8;
            color: var(--text-secondary);
        }

        .report-content h4 {
            color: var(--text-primary);
            margin: 20px 0 10px 0;
            font-size: 1.1rem;
        }

        .report-content p {
            margin-bottom: 15px;
        }

        .report-content ul {
            padding-left: 20px;
            margin-bottom: 15px;
        }

        .report-content li {
            margin-bottom: 8px;
        }

        .report-content strong {
            color: var(--accent-blue);
        }

        .analysis-section {
            background: var(--secondary-bg);
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            border-left: 4px solid var(--accent-blue);
        }

        /* Watchlist */
        .watchlist-section {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .watchlist-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .watchlist-input-group .form-input {
            flex: 1;
            min-width: 200px;
        }

        .watchlist-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .watchlist-tag {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            background: var(--secondary-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .watchlist-tag:hover {
            background: var(--hover-bg);
            border-color: var(--accent-blue);
            transform: translateY(-2px);
        }

        .tag-name {
            font-weight: 500;
            color: var(--text-primary);
        }

        .tag-code {
            font-family: 'JetBrains Mono', monospace;
            color: var(--text-secondary);
        }

        .tag-remove {
            color: var(--accent-down);
            font-weight: 700;
            cursor: pointer;
            padding: 0 4px;
        }

        .tag-remove:hover {
            color: #dc2626;
        }

        .watchlist-empty {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .watchlist-table-container {
            display: none;
            margin-top: 20px;
        }

        .watchlist-loading {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .analyze-link {
            color: var(--accent-blue);
            text-decoration: none;
            font-weight: 500;
            cursor: pointer;
        }

        .analyze-link:hover {
            text-decoration: underline;
        }

        .remove-btn {
            background: transparent;
            border: 1px solid var(--accent-down);
            color: var(--accent-down);
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-left: 10px;
        }

        .remove-btn:hover {
            background: var(--accent-down);
            color: white;
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--card-bg);
            color: var(--text-primary);
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
            z-index: 10000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 30px 20px;
            color: var(--text-muted);
            font-size: 0.9rem;
            border-top: 1px solid var(--border-color);
            margin-top: 50px;
        }

        .footer a {
            color: var(--accent-blue);
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }

            .stock-name {
                font-size: 1.5rem;
            }

            .current-price {
                font-size: 2rem;
            }

            .overview-grid {
                grid-template-columns: 1fr;
            }

            .chart-wrapper {
                height: 300px;
            }

            .button-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Utility Classes */
        .text-center {
            text-align: center;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .mt-20 {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>ğŸ“Š å°è‚¡å°ˆæ¥­åˆ†æç³»çµ± Pro</h1>
            <p>Professional Taiwan Stock Technical Analysis System | æ”¯æ´ä¸Šå¸‚/ä¸Šæ«ƒè‚¡ç¥¨å®Œæ•´æŠ€è¡“åˆ†æ</p>
        </div>

        <!-- Watchlist Section -->
        <div class="watchlist-section">
            <h2 class="section-title">â­ è‡ªé¸è‚¡ç®¡ç†</h2>
            <div class="watchlist-input-group">
                <select id="watchlistMarket" class="form-input" style="flex: 0 0 120px;">
                    <option value="twse">ä¸Šå¸‚</option>
                    <option value="tpex">ä¸Šæ«ƒ</option>
                </select>
                <input type="text" id="watchlistCode" class="form-input" placeholder="è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ (ä¾‹å¦‚: 2330)">
                <button class="btn btn-primary" onclick="app.watchlistManager.quickAdd()">â• åŠ å…¥è‡ªé¸</button>
                <button class="btn btn-secondary" onclick="app.watchlistManager.fetchAllQuotes()">ğŸ”„ æ›´æ–°å ±åƒ¹</button>
                <button class="btn btn-secondary" onclick="app.watchlistManager.clearAll()">ğŸ—‘ï¸ æ¸…ç©ºå…¨éƒ¨</button>
            </div>
            <div id="watchlistTags" class="watchlist-tags"></div>
            
            <div id="watchlistLoading" class="watchlist-loading">
                <div class="spinner"></div>
                <p>æ­£åœ¨æ›´æ–°å ±åƒ¹...</p>
            </div>

            <div id="watchlistTableContainer" class="watchlist-table-container">
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>è‚¡ç¥¨åç¨±</th>
                                <th>å¸‚å ´</th>
                                <th>ç¾åƒ¹</th>
                                <th>æ˜¨æ”¶</th>
                                <th>æ¼²è·Œ</th>
                                <th>æ¼²è·Œå¹…</th>
                                <th>æˆäº¤é‡</th>
                                <th>æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="watchlistBody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Input Section -->
        <div class="input-section">
            <h2 class="section-title">ğŸ” è‚¡ç¥¨æŸ¥è©¢</h2>
            
            <div class="form-group">
                <label class="form-label">é¸æ“‡å¸‚å ´</label>
                <div class="button-group">
                    <button class="market-btn active" data-market="twse" onclick="app.selectMarket('twse')">ğŸ¢ ä¸Šå¸‚ (TWSE)</button>
                    <button class="market-btn" data-market="tpex" onclick="app.selectMarket('tpex')">ğŸª ä¸Šæ«ƒ (TPEx)</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="stockCode">è‚¡ç¥¨ä»£è™Ÿ</label>
                <input type="text" id="stockCode" class="form-input" placeholder="è¼¸å…¥ä¸Šå¸‚è‚¡ç¥¨ä»£è™Ÿ (ä¾‹å¦‚: 2330)">
            </div>

            <div class="form-group">
                <label class="form-label">å¿«é€Ÿé¸æ“‡æ—¥æœŸç¯„åœ</label>
                <div class="button-group">
                    <button class="quick-btn" onclick="app.setDateRange(30)">30å¤©</button>
                    <button class="quick-btn active" onclick="app.setDateRange(60)">60å¤©</button>
                    <button class="quick-btn" onclick="app.setDateRange(90)">90å¤©</button>
                    <button class="quick-btn" onclick="app.setDateRange(180)">180å¤©</button>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="startDate">èµ·å§‹æ—¥æœŸ</label>
                <input type="date" id="startDate" class="form-input">
            </div>

            <div class="form-group">
                <label class="form-label" for="endDate">çµ‚æ­¢æ—¥æœŸ</label>
                <input type="date" id="endDate" class="form-input">
            </div>

            <div id="dateInfo" class="date-info"></div>

            <div class="button-group mt-20">
                <button id="analyzeBtn" class="btn btn-primary" onclick="app.startAnalysis()">
                    ğŸ“Š é–‹å§‹åˆ†æ
                </button>
                <button class="btn btn-secondary" onclick="app.addToWatchlist()">
                    â­ åŠ å…¥è‡ªé¸
                </button>
            </div>
        </div>

        <!-- Loading Animation -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <p id="loadingText" class="loading-text">æ­£åœ¨è¼‰å…¥æ•¸æ“š...</p>
        </div>

        <!-- Error Message -->
        <div id="errorMessage" class="error-message"></div>

        <!-- Results Section -->
        <div id="results" class="results">

            <!-- Stock Header -->
            <div class="stock-header">
                <div class="stock-title">
                    <span id="stockName" class="stock-name">-</span>
                    <span id="stockCodeDisplay" class="stock-code">-</span>
                    <span id="marketTag" class="market-tag twse">ä¸Šå¸‚</span>
                </div>
                <div id="stockDate" class="stock-date">è³‡æ–™æ—¥æœŸ: -</div>
                <div class="price-display">
                    <div id="currentPrice" class="current-price price-flat">-</div>
                    <div id="priceChange" class="price-change">-</div>
                </div>
            </div>

            <!-- Overview Cards -->
            <div class="overview-grid">
                <div class="overview-card">
                    <div class="card-title">æŠ€è¡“é¢è©•åˆ†</div>
                    <div id="techScore" class="card-value">-</div>
                    <div class="card-status" id="techStatus">è¨ˆç®—ä¸­...</div>
                    <div class="progress-bar">
                        <div id="techProgress" class="progress-fill" style="width: 0%"></div>
                    </div>
                </div>

                <div class="overview-card">
                    <div class="card-title">RSI(14)</div>
                    <div id="rsiValue" class="card-value">-</div>
                    <div class="card-status" id="rsiSignal">-</div>
                </div>

                <div class="overview-card">
                    <div class="card-title">KD æŒ‡æ¨™</div>
                    <div id="kdValue" class="card-value">-</div>
                    <div class="card-status" id="kdSignal">-</div>
                </div>

                <div class="overview-card">
                    <div class="card-title">MACD è¨Šè™Ÿ</div>
                    <div id="macdValue" class="card-value">-</div>
                    <div class="card-status" id="macdSignal">-</div>
                </div>

                <div class="overview-card">
                    <div class="card-title">æˆäº¤é‡æ¯”</div>
                    <div id="volumeRatio" class="card-value">-</div>
                    <div class="card-status">vs 20æ—¥å‡é‡</div>
                </div>

                <div class="overview-card">
                    <div class="card-title">æ³¢å‹•ç‡</div>
                    <div id="volatility" class="card-value">-</div>
                    <div class="card-status">20æ—¥æ¨™æº–å·®</div>
                </div>
            </div>

            <!-- Key Levels -->
            <div class="key-levels">
                <h3 class="section-title">ğŸ¯ é—œéµåƒ¹ä½</h3>
                <div class="levels-grid">
                    <div class="level-item">
                        <div class="level-label">å£“åŠ›ä½</div>
                        <div id="resistance" class="level-value" style="color: var(--accent-down)">-</div>
                    </div>
                    <div class="level-item">
                        <div class="level-label">æ”¯æ’ä½</div>
                        <div id="support" class="level-value" style="color: var(--accent-up)">-</div>
                    </div>
                    <div class="level-item">
                        <div class="level-label">MA5</div>
                        <div id="ma5" class="level-value">-</div>
                    </div>
                    <div class="level-item">
                        <div class="level-label">MA20</div>
                        <div id="ma20" class="level-value">-</div>
                    </div>
                </div>
            </div>

            <!-- Price Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">ğŸ“ˆ åƒ¹æ ¼èµ°å‹¢èˆ‡å‡ç·š</h3>
                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3b82f6"></div>
                            <span>æ”¶ç›¤åƒ¹</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f59e0b"></div>
                            <span>MA5</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #8b5cf6"></div>
                            <span>MA10</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #10b981"></div>
                            <span>MA20</span>
                        </div>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>

            <!-- Technical Indicators Tabs -->
            <div class="chart-container">
                <div class="tabs">
                    <button class="tab-btn active" onclick="app.showTab('kd-chart')">KD æŒ‡æ¨™</button>
                    <button class="tab-btn" onclick="app.showTab('macd-chart')">MACD</button>
                    <button class="tab-btn" onclick="app.showTab('technical-table')">æŠ€è¡“æ•¸æ“šè¡¨</button>
                </div>

                <div id="tab-kd-chart" class="tab-content active">
                    <div class="chart-wrapper">
                        <canvas id="kdChart"></canvas>
                    </div>
                </div>

                <div id="tab-macd-chart" class="tab-content">
                    <div class="chart-wrapper">
                        <canvas id="macdChart"></canvas>
                    </div>
                </div>

                <div id="tab-technical-table" class="tab-content">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>æ—¥æœŸ</th>
                                    <th>æ”¶ç›¤</th>
                                    <th>æ¼²è·Œ</th>
                                    <th>æˆäº¤é‡</th>
                                    <th>MA5</th>
                                    <th>MA10</th>
                                    <th>MA20</th>
                                    <th>RSI</th>
                                    <th>K</th>
                                    <th>D</th>
                                </tr>
                            </thead>
                            <tbody id="technicalBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Alerts Section -->
            <div class="alerts-section">
                <h3 class="section-title">âš ï¸ æ™ºèƒ½è­¦ç¤º</h3>
                <div class="alerts-summary">
                    <div class="alert-stat">
                        <span class="alert-stat-icon">ğŸŸ¢</span>
                        <div>
                            <div id="bullishCount" class="alert-stat-value">0</div>
                            <div class="alert-stat-label">çœ‹æ¼²è¨Šè™Ÿ</div>
                        </div>
                    </div>
                    <div class="alert-stat">
                        <span class="alert-stat-icon">ğŸ”´</span>
                        <div>
                            <div id="bearishCount" class="alert-stat-value">0</div>
                            <div class="alert-stat-label">çœ‹è·Œè¨Šè™Ÿ</div>
                        </div>
                    </div>
                    <div class="alert-stat">
                        <span class="alert-stat-icon">ğŸŸ¡</span>
                        <div>
                            <div id="warningCount" class="alert-stat-value">0</div>
                            <div class="alert-stat-label">è­¦å‘Šè¨Šè™Ÿ</div>
                        </div>
                    </div>
                    <div class="alert-stat">
                        <span class="alert-stat-icon">ğŸ“Š</span>
                        <div>
                            <div id="alertScore" class="alert-stat-value">0</div>
                            <div class="alert-stat-label">ç¶œåˆè©•åˆ†</div>
                        </div>
                    </div>
                </div>
                <div id="alertsList"></div>
            </div>

            <!-- AI Report -->
            <div class="ai-report">
                <div class="report-header">
                    <h3 class="section-title">ğŸ¤– AI åˆ†æå ±å‘Š</h3>
                    <button class="btn btn-secondary" onclick="app.copyReport()">ğŸ“‹ è¤‡è£½å ±å‘Š</button>
                </div>
                <div id="aiReportContent" class="report-content">
                    <p>åˆ†æå ±å‘Šç”Ÿæˆä¸­...</p>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>âš ï¸ å…è²¬è²æ˜ï¼šæœ¬ç³»çµ±åƒ…ä¾›æ•™è‚²èˆ‡ç ”ç©¶ç”¨é€”ï¼Œæ‰€æœ‰è³‡è¨Šä¸æ§‹æˆä»»ä½•æŠ•è³‡å»ºè­°ã€‚</p>
            <p>è³‡æ–™ä¾†æºï¼š<a href="https://www.twse.com.tw" target="_blank">è­‰äº¤æ‰€</a> | <a href="https://www.tpex.org.tw" target="_blank">æ«ƒè²·ä¸­å¿ƒ</a></p>
            <p>Â© 2026 å°è‚¡å°ˆæ¥­åˆ†æç³»çµ± Pro | Powered by Chart.js & Open Data</p>
        </div>
    </div>

    <script>
        'use strict';

        // ==================== å·¥å…·é¡åˆ¥ ====================
        /**
         * é€šç”¨å·¥å…·é¡åˆ¥
         * @class Utils
         */
        class Utils {
            /**
             * æ ¼å¼åŒ–æ—¥æœŸç‚º YYYY-MM-DD
             * @param {Date} date - æ—¥æœŸç‰©ä»¶
             * @returns {string} æ ¼å¼åŒ–å¾Œçš„æ—¥æœŸå­—ä¸²
             */
            static formatDate(date) {
                if (!date || !(date instanceof Date)) {
                    console.error('Invalid date object:', date);
                    return '';
                }
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            /**
             * è½‰æ›ç‚ºæ°‘åœ‹å¹´æ ¼å¼
             * @param {Date} date - æ—¥æœŸç‰©ä»¶
             * @returns {string} æ°‘åœ‹å¹´æ ¼å¼å­—ä¸²
             */
            static toROCDate(date) {
                if (!date || !(date instanceof Date)) {
                    return '';
                }
                const year = date.getFullYear() - 1911;
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}${month}${day}`;
            }

            /**
             * æ ¼å¼åŒ–æˆäº¤é‡
             * @param {number} volume - æˆäº¤é‡
             * @returns {string} æ ¼å¼åŒ–å¾Œçš„æˆäº¤é‡å­—ä¸²
             */
            static formatVolume(volume) {
                if (volume >= 100000000) {
                    return (volume / 100000000).toFixed(2) + 'å„„';
                } else if (volume >= 10000) {
                    return (volume / 10000).toFixed(2) + 'è¬';
                }
                return volume.toLocaleString();
            }

            /**
             * é¡¯ç¤º Toast æç¤ºè¨Šæ¯
             * @param {string} message - æç¤ºè¨Šæ¯
             * @param {number} duration - é¡¯ç¤ºæ™‚é•·ï¼ˆæ¯«ç§’ï¼‰
             */
            static showToast(message, duration = 3000) {
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.textContent = message;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideIn 0.3s ease reverse';
                    setTimeout(() => {
                        document.body.removeChild(toast);
                    }, 300);
                }, duration);
            }

            /**
             * é©—è­‰è‚¡ç¥¨ä»£è™Ÿæ ¼å¼
             * @param {string} code - è‚¡ç¥¨ä»£è™Ÿ
             * @returns {boolean} æ˜¯å¦æœ‰æ•ˆ
             */
            static validateStockCode(code) {
                if (!code || typeof code !== 'string') {
                    return false;
                }
                // å°è‚¡ä»£è™Ÿé€šå¸¸ç‚º 4-6 ä½æ•¸å­—
                return /^\d{4,6}$/.test(code.trim());
            }

            /**
             * XSS é˜²è­· - æ¸…ç† HTML å­—ä¸²
             * @param {string} str - è¼¸å…¥å­—ä¸²
             * @returns {string} æ¸…ç†å¾Œçš„å­—ä¸²
             */
            static sanitizeHTML(str) {
                if (!str) return '';
                const div = document.createElement('div');
                div.textContent = str;
                return div.innerHTML;
            }

            /**
             * æ·±æ‹·è²ç‰©ä»¶
             * @param {Object} obj - è¦æ‹·è²çš„ç‰©ä»¶
             * @returns {Object} æ‹·è²å¾Œçš„ç‰©ä»¶
             */
            static deepClone(obj) {
                try {
                    return JSON.parse(JSON.stringify(obj));
                } catch (e) {
                    console.error('Deep clone failed:', e);
                    return obj;
                }
            }
        }

        // ==================== ç¶²è·¯è«‹æ±‚ç®¡ç†é¡åˆ¥ ====================
        /**
         * ç¶²è·¯è«‹æ±‚ç®¡ç†é¡åˆ¥
         * @class NetworkManager
         */
        class NetworkManager {
            constructor() {
                this.cache = new Map();
                this.cacheExpiry = 5 * 60 * 1000; // 5 åˆ†é˜å¿«å–
                this.corsProxies = [
                    'https://api.allorigins.win/raw?url=',
                    'https://corsproxy.io/?'
                ];
                this.currentProxyIndex = 0;
            }

            /**
             * å¸¶è¶…æ™‚çš„ fetch è«‹æ±‚
             * @param {string} url - è«‹æ±‚ URL
             * @param {number} timeout - è¶…æ™‚æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
             * @returns {Promise<Response>}
             */
            async fetchWithTimeout(url, timeout = 10000) {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), timeout);

                try {
                    const response = await fetch(url, {
                        signal: controller.signal,
                        headers: {
                            'Accept': 'application/json',
                        }
                    });
                    clearTimeout(timeoutId);
                    return response;
                } catch (error) {
                    clearTimeout(timeoutId);
                    if (error.name === 'AbortError') {
                        throw new Error('è«‹æ±‚è¶…æ™‚ï¼Œè«‹ç¨å¾Œå†è©¦');
                    }
                    throw error;
                }
            }

            /**
             * ä½¿ç”¨ä»£ç†é€²è¡Œè«‹æ±‚ï¼ˆå«é‡è©¦æ©Ÿåˆ¶ï¼‰
             * @param {string} url - è«‹æ±‚ URL
             * @param {number} maxRetries - æœ€å¤§é‡è©¦æ¬¡æ•¸
             * @returns {Promise<any>}
             */
            async fetchWithProxy(url, maxRetries = 3) {
                // æª¢æŸ¥å¿«å–
                const cacheKey = url;
                const cached = this.cache.get(cacheKey);
                if (cached && Date.now() - cached.timestamp < this.cacheExpiry) {
                    console.log('âœ… ä½¿ç”¨å¿«å–è³‡æ–™:', url);
                    return cached.data;
                }

                let lastError;
                for (let attempt = 0; attempt < maxRetries; attempt++) {
                    try {
                        const proxyUrl = this.corsProxies[this.currentProxyIndex] + encodeURIComponent(url);
                        console.log(`ğŸ”„ å˜—è©¦è«‹æ±‚ (${attempt + 1}/${maxRetries}):`, proxyUrl);

                        const response = await this.fetchWithTimeout(proxyUrl, 10000);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }

                        const data = await response.json();
                        
                        // å„²å­˜åˆ°å¿«å–
                        this.cache.set(cacheKey, {
                            data: data,
                            timestamp: Date.now()
                        });

                        // æ¸…é™¤éæœŸå¿«å–
                        this.clearExpiredCache();

                        console.log('âœ… è«‹æ±‚æˆåŠŸ');
                        return data;

                    } catch (error) {
                        console.warn(`âŒ è«‹æ±‚å¤±æ•— (${attempt + 1}/${maxRetries}):`, error.message);
                        lastError = error;

                        // åˆ‡æ›ä»£ç†
                        this.currentProxyIndex = (this.currentProxyIndex + 1) % this.corsProxies.length;

                        // æŒ‡æ•¸é€€é¿å»¶é²
                        if (attempt < maxRetries - 1) {
                            const delay = Math.min(1000 * Math.pow(2, attempt), 5000);
                            console.log(`â³ ç­‰å¾… ${delay}ms å¾Œé‡è©¦...`);
                            await this.delay(delay);
                        }
                    }
                }

                throw new Error(`è«‹æ±‚å¤±æ•—ï¼ˆå·²é‡è©¦ ${maxRetries} æ¬¡ï¼‰: ${lastError.message}`);
            }

            /**
             * å»¶é²å‡½æ•¸
             * @param {number} ms - å»¶é²æ™‚é–“ï¼ˆæ¯«ç§’ï¼‰
             * @returns {Promise<void>}
             */
            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            /**
             * æ¸…é™¤éæœŸå¿«å–
             */
            clearExpiredCache() {
                const now = Date.now();
                for (const [key, value] of this.cache.entries()) {
                    if (now - value.timestamp > this.cacheExpiry) {
                        this.cache.delete(key);
                        console.log('ğŸ—‘ï¸ æ¸…é™¤éæœŸå¿«å–:', key);
                    }
                }
            }
        }

        // ==================== æŠ€è¡“æŒ‡æ¨™è¨ˆç®—é¡åˆ¥ ====================
        /**
         * æŠ€è¡“æŒ‡æ¨™è¨ˆç®—é¡åˆ¥
         * @class TechnicalIndicators
         */
        class TechnicalIndicators {
            /**
             * è¨ˆç®—ç§»å‹•å¹³å‡ç·š
             * @param {Array} data - åƒ¹æ ¼è³‡æ–™é™£åˆ—
             * @param {number} period - é€±æœŸ
             * @returns {Array} MA å€¼é™£åˆ—
             */
            static calculateMA(data, period) {
                const result = [];
                for (let i = 0; i < data.length; i++) {
                    if (i < period - 1) {
                        result.push(null);
                    } else {
                        let sum = 0;
                        for (let j = 0; j < period; j++) {
                            sum += data[i - j].close;
                        }
                        result.push(sum / period);
                    }
                }
                return result;
            }

            /**
             * è¨ˆç®— RSI æŒ‡æ¨™
             * @param {Array} data - åƒ¹æ ¼è³‡æ–™é™£åˆ—
             * @param {number} period - é€±æœŸï¼ˆé è¨­ 14ï¼‰
             * @returns {Array} RSI å€¼é™£åˆ—
             */
            static calculateRSI(data, period = 14) {
                const result = [];
                let gains = [];
                let losses = [];

                for (let i = 0; i < data.length; i++) {
                    if (i === 0) {
                        result.push(null);
                        continue;
                    }

                    const change = data[i].close - data[i - 1].close;
                    gains.push(change > 0 ? change : 0);
                    losses.push(change < 0 ? Math.abs(change) : 0);

                    if (i < period) {
                        result.push(null);
                    } else {
                        const avgGain = gains.slice(-period).reduce((a, b) => a + b, 0) / period;
                        const avgLoss = losses.slice(-period).reduce((a, b) => a + b, 0) / period;
                        
                        if (avgLoss === 0) {
                            result.push(100);
                        } else {
                            const rs = avgGain / avgLoss;
                            const rsi = 100 - (100 / (1 + rs));
                            result.push(rsi);
                        }
                    }
                }
                return result;
            }

            /**
             * è¨ˆç®— KD æŒ‡æ¨™
             * @param {Array} highs - æœ€é«˜åƒ¹é™£åˆ—
             * @param {Array} lows - æœ€ä½åƒ¹é™£åˆ—
             * @param {Array} closes - æ”¶ç›¤åƒ¹é™£åˆ—
             * @param {number} period - é€±æœŸï¼ˆé è¨­ 9ï¼‰
             * @returns {Object} { k: Array, d: Array }
             */
            static calculateKD(highs, lows, closes, period = 9) {
                const rsv = [];
                const k = [];
                const d = [];

                for (let i = 0; i < closes.length; i++) {
                    if (i < period - 1) {
                        rsv.push(null);
                        k.push(null);
                        d.push(null);
                    } else {
                        const periodHigh = Math.max(...highs.slice(i - period + 1, i + 1));
                        const periodLow = Math.min(...lows.slice(i - period + 1, i + 1));
                        
                        if (periodHigh === periodLow) {
                            rsv.push(50);
                        } else {
                            rsv.push(((closes[i] - periodLow) / (periodHigh - periodLow)) * 100);
                        }

                        if (k.length === 0 || k[k.length - 1] === null) {
                            k.push(50);
                        } else {
                            k.push((2/3) * k[k.length - 1] + (1/3) * rsv[rsv.length - 1]);
                        }

                        if (d.length === 0 || d[d.length - 1] === null) {
                            d.push(50);
                        } else {
                            d.push((2/3) * d[d.length - 1] + (1/3) * k[k.length - 1]);
                        }
                    }
                }

                return { k, d };
            }

            /**
             * è¨ˆç®— EMAï¼ˆæŒ‡æ•¸ç§»å‹•å¹³å‡ï¼‰
             * @param {Array} data - åƒ¹æ ¼è³‡æ–™é™£åˆ—
             * @param {number} period - é€±æœŸ
             * @returns {Array} EMA å€¼é™£åˆ—
             */
            static calculateEMA(data, period) {
                const result = [];
                const multiplier = 2 / (period + 1);

                for (let i = 0; i < data.length; i++) {
                    if (i < period - 1) {
                        result.push(null);
                    } else if (i === period - 1) {
                        let sum = 0;
                        for (let j = 0; j < period; j++) {
                            sum += data[i - j].close;
                        }
                        result.push(sum / period);
                    } else {
                        const ema = (data[i].close - result[i - 1]) * multiplier + result[i - 1];
                        result.push(ema);
                    }
                }
                return result;
            }

            /**
             * è¨ˆç®— MACD æŒ‡æ¨™
             * @param {Array} data - åƒ¹æ ¼è³‡æ–™é™£åˆ—
             * @returns {Object} { dif: Array, macd: Array, osc: Array }
             */
            static calculateMACD(data) {
                const ema12 = this.calculateEMA(data, 12);
                const ema26 = this.calculateEMA(data, 26);
                const dif = [];
                
                for (let i = 0; i < data.length; i++) {
                    if (ema12[i] === null || ema26[i] === null) {
                        dif.push(null);
                    } else {
                        dif.push(ema12[i] - ema26[i]);
                    }
                }

                const macdData = dif.map((val, idx) => ({ close: val || 0 }));
                const macd = this.calculateEMA(macdData, 9);
                
                const osc = [];
                for (let i = 0; i < dif.length; i++) {
                    if (dif[i] === null || macd[i] === null) {
                        osc.push(null);
                    } else {
                        osc.push(dif[i] - macd[i]);
                    }
                }

                return { dif, macd, osc };
            }

            /**
             * è¨ˆç®—å¸ƒæ—é€šé“
             * @param {Array} data - åƒ¹æ ¼è³‡æ–™é™£åˆ—
             * @param {number} period - é€±æœŸï¼ˆé è¨­ 20ï¼‰
             * @param {number} stdDev - æ¨™æº–å·®å€æ•¸ï¼ˆé è¨­ 2ï¼‰
             * @returns {Object} { upper: Array, middle: Array, lower: Array }
             */
            static calculateBollinger(data, period = 20, stdDev = 2) {
                const middle = this.calculateMA(data, period);
                const upper = [];
                const lower = [];

                for (let i = 0; i < data.length; i++) {
                    if (i < period - 1 || middle[i] === null) {
                        upper.push(null);
                        lower.push(null);
                    } else {
                        let sum = 0;
                        for (let j = 0; j < period; j++) {
                            sum += Math.pow(data[i - j].close - middle[i], 2);
                        }
                        const std = Math.sqrt(sum / period);
                        upper.push(middle[i] + stdDev * std);
                        lower.push(middle[i] - stdDev * std);
                    }
                }

                return { upper, middle, lower };
            }
        }

        // ==================== è­¦ç¤ºç”Ÿæˆé¡åˆ¥ ====================
        /**
         * è­¦ç¤ºç”Ÿæˆé¡åˆ¥
         * @class AlertGenerator
         */
        class AlertGenerator {
            /**
             * ç”Ÿæˆè­¦ç¤ºè¨Šæ¯
             * @param {Object} stockData - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             * @returns {Array} è­¦ç¤ºé™£åˆ—
             */
            static generate(stockData, indicators) {
                const alerts = [];
                const latest = stockData[stockData.length - 1];
                const prev = stockData[stockData.length - 2];

                // MA äº¤å‰è­¦ç¤º
                if (indicators.ma5[indicators.ma5.length - 1] > indicators.ma20[indicators.ma20.length - 1] &&
                    indicators.ma5[indicators.ma5.length - 2] <= indicators.ma20[indicators.ma20.length - 2]) {
                    alerts.push({
                        type: 'bullish',
                        priority: 1,
                        title: 'é»ƒé‡‘äº¤å‰',
                        desc: 'MA5 å‘ä¸Šçªç ´ MA20ï¼ŒçŸ­æœŸè¶¨å‹¢è½‰å¼·',
                        icon: 'ğŸ“ˆ'
                    });
                }

                if (indicators.ma5[indicators.ma5.length - 1] < indicators.ma20[indicators.ma20.length - 1] &&
                    indicators.ma5[indicators.ma5.length - 2] >= indicators.ma20[indicators.ma20.length - 2]) {
                    alerts.push({
                        type: 'bearish',
                        priority: 1,
                        title: 'æ­»äº¡äº¤å‰',
                        desc: 'MA5 å‘ä¸‹è·Œç ´ MA20ï¼ŒçŸ­æœŸè¶¨å‹¢è½‰å¼±',
                        icon: 'ğŸ“‰'
                    });
                }

                // RSI è¶…è²·è¶…è³£
                const rsi = indicators.rsi[indicators.rsi.length - 1];
                if (rsi > 70) {
                    alerts.push({
                        type: 'warning',
                        priority: 2,
                        title: 'RSI è¶…è²·',
                        desc: `RSI é” ${rsi.toFixed(2)}ï¼Œå¸‚å ´å¯èƒ½éç†±`,
                        icon: 'ğŸ”¥'
                    });
                } else if (rsi < 30) {
                    alerts.push({
                        type: 'bullish',
                        priority: 2,
                        title: 'RSI è¶…è³£',
                        desc: `RSI é” ${rsi.toFixed(2)}ï¼Œå¯èƒ½å‡ºç¾åå½ˆ`,
                        icon: 'ğŸ’'
                    });
                }

                // KD æŒ‡æ¨™
                const k = indicators.kd.k[indicators.kd.k.length - 1];
                const d = indicators.kd.d[indicators.kd.d.length - 1];
                
                if (k > 80 && d > 80) {
                    alerts.push({
                        type: 'warning',
                        priority: 2,
                        title: 'KD è¶…è²·',
                        desc: `K=${k.toFixed(2)}, D=${d.toFixed(2)}ï¼ŒçŸ­æœŸå¯èƒ½å›æª”`,
                        icon: 'âš ï¸'
                    });
                } else if (k < 20 && d < 20) {
                    alerts.push({
                        type: 'bullish',
                        priority: 2,
                        title: 'KD è¶…è³£',
                        desc: `K=${k.toFixed(2)}, D=${d.toFixed(2)}ï¼Œå¯èƒ½ç¯‰åº•åå½ˆ`,
                        icon: 'âœ¨'
                    });
                }

                // KD äº¤å‰
                const prevK = indicators.kd.k[indicators.kd.k.length - 2];
                const prevD = indicators.kd.d[indicators.kd.d.length - 2];
                
                if (k > d && prevK <= prevD && k < 80) {
                    alerts.push({
                        type: 'bullish',
                        priority: 1,
                        title: 'KD é»ƒé‡‘äº¤å‰',
                        desc: 'K ç·šå‘ä¸Šçªç ´ D ç·šï¼Œè²·é€²è¨Šè™Ÿ',
                        icon: 'ğŸ¯'
                    });
                } else if (k < d && prevK >= prevD && k > 20) {
                    alerts.push({
                        type: 'bearish',
                        priority: 1,
                        title: 'KD æ­»äº¡äº¤å‰',
                        desc: 'K ç·šå‘ä¸‹è·Œç ´ D ç·šï¼Œè³£å‡ºè¨Šè™Ÿ',
                        icon: 'âš¡'
                    });
                }

                // MACD è¨Šè™Ÿ
                const macdDif = indicators.macd.dif[indicators.macd.dif.length - 1];
                const macdSignal = indicators.macd.macd[indicators.macd.macd.length - 1];
                const macdOsc = indicators.macd.osc[indicators.macd.osc.length - 1];
                
                if (macdOsc > 0 && indicators.macd.osc[indicators.macd.osc.length - 2] <= 0) {
                    alerts.push({
                        type: 'bullish',
                        priority: 1,
                        title: 'MACD å¤šé ­è¨Šè™Ÿ',
                        desc: 'DIF å‘ä¸Šçªç ´ MACDï¼Œè¶¨å‹¢è½‰å¤š',
                        icon: 'ğŸš€'
                    });
                } else if (macdOsc < 0 && indicators.macd.osc[indicators.macd.osc.length - 2] >= 0) {
                    alerts.push({
                        type: 'bearish',
                        priority: 1,
                        title: 'MACD ç©ºé ­è¨Šè™Ÿ',
                        desc: 'DIF å‘ä¸‹è·Œç ´ MACDï¼Œè¶¨å‹¢è½‰ç©º',
                        icon: 'ğŸ”»'
                    });
                }

                // æˆäº¤é‡ç•°å¸¸
                const avgVolume = stockData.slice(-20).reduce((sum, d) => sum + d.volume, 0) / 20;
                const volumeRatio = latest.volume / avgVolume;
                
                if (volumeRatio > 2) {
                    alerts.push({
                        type: 'warning',
                        priority: 2,
                        title: 'æˆäº¤é‡æš´å¢',
                        desc: `æˆäº¤é‡é” 20 æ—¥å‡é‡çš„ ${volumeRatio.toFixed(2)} å€`,
                        icon: 'ğŸ“Š'
                    });
                }

                // åƒ¹æ ¼çªç ´
                const resistance = Math.max(...stockData.slice(-20).map(d => d.high));
                const support = Math.min(...stockData.slice(-20).map(d => d.low));
                
                if (latest.close > resistance * 0.98) {
                    alerts.push({
                        type: 'bullish',
                        priority: 1,
                        title: 'çªç ´å£“åŠ›',
                        desc: `æ”¶ç›¤åƒ¹æ¥è¿‘æˆ–çªç ´ 20 æ—¥é«˜é» ${resistance.toFixed(2)}`,
                        icon: 'ğŸŠ'
                    });
                }
                
                if (latest.close < support * 1.02) {
                    alerts.push({
                        type: 'bearish',
                        priority: 1,
                        title: 'è·Œç ´æ”¯æ’',
                        desc: `æ”¶ç›¤åƒ¹æ¥è¿‘æˆ–è·Œç ´ 20 æ—¥ä½é» ${support.toFixed(2)}`,
                        icon: 'âš ï¸'
                    });
                }

                return alerts;
            }

            /**
             * è¨ˆç®—ç¶œåˆè©•åˆ†
             * @param {Array} alerts - è­¦ç¤ºé™£åˆ—
             * @returns {number} è©•åˆ† (-100 åˆ° 100)
             */
            static calculateScore(alerts) {
                let score = 0;
                alerts.forEach(alert => {
                    const weight = alert.priority === 1 ? 15 : 10;
                    if (alert.type === 'bullish') {
                        score += weight;
                    } else if (alert.type === 'bearish') {
                        score -= weight;
                    }
                });
                return Math.max(-100, Math.min(100, score));
            }
        }

        // ==================== è‡ªé¸è‚¡ç®¡ç†é¡åˆ¥ ====================
        /**
         * è‡ªé¸è‚¡ç®¡ç†é¡åˆ¥
         * @class WatchlistManager
         */
        class WatchlistManager {
            constructor(networkManager) {
                this.networkManager = networkManager;
                this.watchlist = this.load();
            }

            /**
             * å¾ LocalStorage è¼‰å…¥è‡ªé¸è‚¡
             * @returns {Array} è‡ªé¸è‚¡é™£åˆ—
             */
            load() {
                try {
                    const data = localStorage.getItem('stockWatchlist');
                    return data ? JSON.parse(data) : [];
                } catch (e) {
                    console.error('è¼‰å…¥è‡ªé¸è‚¡å¤±æ•—:', e);
                    return [];
                }
            }

            /**
             * å„²å­˜è‡ªé¸è‚¡åˆ° LocalStorage
             */
            save() {
                try {
                    localStorage.setItem('stockWatchlist', JSON.stringify(this.watchlist));
                    console.log('âœ… è‡ªé¸è‚¡å·²å„²å­˜');
                } catch (e) {
                    console.error('å„²å­˜è‡ªé¸è‚¡å¤±æ•—:', e);
                }
            }

            /**
             * æ–°å¢è‚¡ç¥¨åˆ°è‡ªé¸è‚¡
             * @param {string} code - è‚¡ç¥¨ä»£è™Ÿ
             * @param {string} market - å¸‚å ´ (twse/tpex)
             * @param {string} name - è‚¡ç¥¨åç¨±
             */
            add(code, market, name = '') {
                if (!Utils.validateStockCode(code)) {
                    Utils.showToast('âŒ è‚¡ç¥¨ä»£è™Ÿæ ¼å¼éŒ¯èª¤');
                    return;
                }

                const exists = this.watchlist.some(item => 
                    item.code === code && item.market === market
                );

                if (exists) {
                    Utils.showToast('âš ï¸ æ­¤è‚¡ç¥¨å·²åœ¨è‡ªé¸è‚¡ä¸­');
                    return;
                }

                this.watchlist.push({
                    code: code,
                    market: market,
                    name: name || code,
                    addedAt: new Date().toISOString()
                });

                this.save();
                this.render();
                Utils.showToast('âœ… å·²åŠ å…¥è‡ªé¸è‚¡');
            }

            /**
             * å¾è‡ªé¸è‚¡ç§»é™¤è‚¡ç¥¨
             * @param {number} index - ç´¢å¼•
             */
            remove(index) {
                if (index >= 0 && index < this.watchlist.length) {
                    const stock = this.watchlist[index];
                    this.watchlist.splice(index, 1);
                    this.save();
                    this.render();
                    Utils.showToast(`âœ… å·²ç§»é™¤ ${stock.name}`);
                }
            }

            /**
             * æ¸…ç©ºæ‰€æœ‰è‡ªé¸è‚¡
             */
            clearAll() {
                if (this.watchlist.length === 0) {
                    Utils.showToast('âš ï¸ è‡ªé¸è‚¡å·²ç¶“æ˜¯ç©ºçš„');
                    return;
                }

                if (confirm('ç¢ºå®šè¦æ¸…ç©ºæ‰€æœ‰è‡ªé¸è‚¡å—ï¼Ÿ')) {
                    this.watchlist = [];
                    this.save();
                    this.render();
                    Utils.showToast('âœ… å·²æ¸…ç©ºè‡ªé¸è‚¡');
                }
            }

            /**
             * å¿«é€Ÿæ–°å¢ï¼ˆå¾è¼¸å…¥æ¡†ï¼‰
             */
            quickAdd() {
                const market = document.getElementById('watchlistMarket').value;
                const code = document.getElementById('watchlistCode').value.trim();

                if (!code) {
                    Utils.showToast('âš ï¸ è«‹è¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ');
                    return;
                }

                this.add(code, market);
                document.getElementById('watchlistCode').value = '';
            }

            /**
             * æ‰¹é‡ç²å–è‡ªé¸è‚¡å ±åƒ¹ï¼ˆä¸¦è¡Œè™•ç†ï¼‰
             */
            async fetchAllQuotes() {
                if (this.watchlist.length === 0) {
                    Utils.showToast('âš ï¸ è‡ªé¸è‚¡æ˜¯ç©ºçš„');
                    return;
                }

                const loadingEl = document.getElementById('watchlistLoading');
                const tableEl = document.getElementById('watchlistTableContainer');
                
                loadingEl.style.display = 'block';
                tableEl.style.display = 'none';

                try {
                    // ä¸¦è¡Œè™•ç†æ‰€æœ‰è«‹æ±‚ï¼ˆæ•ˆèƒ½å„ªåŒ–ï¼‰
                    const promises = this.watchlist.map(stock => 
                        this.fetchQuote(stock.code, stock.market)
                            .catch(err => {
                                console.warn(`ç²å– ${stock.code} å ±åƒ¹å¤±æ•—:`, err);
                                return null;
                            })
                    );

                    const quotes = await Promise.all(promises);

                    // æ›´æ–°è‡ªé¸è‚¡è³‡æ–™
                    quotes.forEach((quote, index) => {
                        if (quote) {
                            this.watchlist[index] = {
                                ...this.watchlist[index],
                                ...quote
                            };
                        }
                    });

                    this.renderTable();
                    Utils.showToast('âœ… å ±åƒ¹æ›´æ–°å®Œæˆ');

                } catch (error) {
                    console.error('æ‰¹é‡æ›´æ–°å¤±æ•—:', error);
                    Utils.showToast('âŒ æ›´æ–°å¤±æ•—: ' + error.message);
                } finally {
                    loadingEl.style.display = 'none';
                }
            }

            /**
             * ç²å–å–®ä¸€è‚¡ç¥¨å ±åƒ¹
             * @param {string} code - è‚¡ç¥¨ä»£è™Ÿ
             * @param {string} market - å¸‚å ´
             * @returns {Promise<Object>} å ±åƒ¹è³‡æ–™
             */
            async fetchQuote(code, market) {
                try {
                    let url;
                    if (market === 'twse') {
                        // è­‰äº¤æ‰€å³æ™‚å ±åƒ¹ API
                        url = `https://mis.twse.com.tw/stock/api/getStockInfo.jsp?ex_ch=tse_${code}.tw&json=1&delay=0`;
                    } else {
                        // ä¸Šæ«ƒä½¿ç”¨ Yahoo Finance
                        url = `https://query1.finance.yahoo.com/v8/finance/chart/${code}.TWO?interval=1d&range=1d`;
                    }

                    const data = await this.networkManager.fetchWithProxy(url);

                    if (market === 'twse' && data.msgArray && data.msgArray.length > 0) {
                        const quote = data.msgArray[0];
                        return {
                            name: quote.n || code,
                            price: parseFloat(quote.z) || 0,
                            previousClose: parseFloat(quote.y) || 0,
                            change: parseFloat(quote.z) - parseFloat(quote.y),
                            changePercent: ((parseFloat(quote.z) - parseFloat(quote.y)) / parseFloat(quote.y) * 100),
                            volume: parseInt(quote.v) || 0
                        };
                    } else if (market === 'tpex' && data.chart && data.chart.result) {
                        const result = data.chart.result[0];
                        const meta = result.meta;
                        const quote = result.indicators.quote[0];
                        
                        return {
                            name: meta.symbol || code,
                            price: meta.regularMarketPrice || 0,
                            previousClose: meta.previousClose || 0,
                            change: (meta.regularMarketPrice || 0) - (meta.previousClose || 0),
                            changePercent: ((meta.regularMarketPrice - meta.previousClose) / meta.previousClose * 100),
                            volume: quote.volume[quote.volume.length - 1] || 0
                        };
                    }

                    throw new Error('ç„¡æ³•è§£æå ±åƒ¹è³‡æ–™');

                } catch (error) {
                    console.error(`ç²å– ${code} å ±åƒ¹å¤±æ•—:`, error);
                    throw error;
                }
            }

            /**
             * æ¸²æŸ“è‡ªé¸è‚¡æ¨™ç±¤
             */
            render() {
                const container = document.getElementById('watchlistTags');
                
                if (this.watchlist.length === 0) {
                    container.innerHTML = '<div class="watchlist-empty">å°šæœªåŠ å…¥ä»»ä½•è‡ªé¸è‚¡</div>';
                    document.getElementById('watchlistTableContainer').style.display = 'none';
                    return;
                }

                container.innerHTML = this.watchlist.map((stock, index) => `
                    <div class="watchlist-tag">
                        <span class="tag-name">${Utils.sanitizeHTML(stock.name)}</span>
                        <span class="tag-code">${Utils.sanitizeHTML(stock.code)}</span>
                        <span class="tag-remove" onclick="app.watchlistManager.remove(${index})">âœ•</span>
                    </div>
                `).join('');
            }

            /**
             * æ¸²æŸ“è‡ªé¸è‚¡è¡¨æ ¼
             */
            renderTable() {
                const tbody = document.getElementById('watchlistBody');
                const tableContainer = document.getElementById('watchlistTableContainer');

                if (this.watchlist.length === 0) {
                    tableContainer.style.display = 'none';
                    return;
                }

                tbody.innerHTML = this.watchlist.map((stock, index) => {
                    const change = stock.change || 0;
                    const changePercent = stock.changePercent || 0;
                    const priceClass = change > 0 ? 'price-up' : change < 0 ? 'price-down' : 'price-flat';
                    
                    return `
                        <tr>
                            <td>
                                <a href="#" class="analyze-link" onclick="app.analyzeFromWatchlist('${stock.code}', '${stock.market}'); return false;">
                                    ${Utils.sanitizeHTML(stock.name)}
                                </a>
                            </td>
                            <td>${stock.market === 'twse' ? 'ä¸Šå¸‚' : 'ä¸Šæ«ƒ'}</td>
                            <td class="${priceClass}">${stock.price ? stock.price.toFixed(2) : '-'}</td>
                            <td>${stock.previousClose ? stock.previousClose.toFixed(2) : '-'}</td>
                            <td class="${priceClass}">${change ? (change > 0 ? '+' : '') + change.toFixed(2) : '-'}</td>
                            <td class="${priceClass}">${changePercent ? (changePercent > 0 ? '+' : '') + changePercent.toFixed(2) + '%' : '-'}</td>
                            <td>${stock.volume ? Utils.formatVolume(stock.volume) : '-'}</td>
                            <td>
                                <button class="remove-btn" onclick="app.watchlistManager.remove(${index})">ç§»é™¤</button>
                            </td>
                        </tr>
                    `;
                }).join('');

                tableContainer.style.display = 'block';
            }
        }

        // ==================== ä¸»æ‡‰ç”¨ç¨‹å¼é¡åˆ¥ ====================
        /**
         * ä¸»æ‡‰ç”¨ç¨‹å¼é¡åˆ¥
         * @class StockAnalyzerApp
         */
        class StockAnalyzerApp {
            constructor() {
                this.networkManager = new NetworkManager();
                this.watchlistManager = new WatchlistManager(this.networkManager);
                this.selectedMarket = 'twse';
                this.stockData = null;
                this.indicators = null;
                this.charts = {};
            }

            /**
             * åˆå§‹åŒ–æ‡‰ç”¨ç¨‹å¼
             */
            init() {
                console.log('ğŸš€ å°è‚¡å°ˆæ¥­åˆ†æç³»çµ± Pro v2.0 å•Ÿå‹•');
                this.setDateRange(60);
                this.watchlistManager.render();
            }

            /**
             * é¸æ“‡å¸‚å ´
             * @param {string} market - å¸‚å ´ä»£ç¢¼ (twse/tpex)
             */
            selectMarket(market) {
                this.selectedMarket = market;
                document.querySelectorAll('.market-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.market === market);
                });
                
                const stockCodeInput = document.getElementById('stockCode');
                stockCodeInput.placeholder = market === 'twse' 
                    ? 'è¼¸å…¥ä¸Šå¸‚è‚¡ç¥¨ä»£è™Ÿ (ä¾‹å¦‚: 2330)' 
                    : 'è¼¸å…¥ä¸Šæ«ƒè‚¡ç¥¨ä»£è™Ÿ (ä¾‹å¦‚: 5274)';
            }

            /**
             * è¨­å®šæ—¥æœŸç¯„åœ
             * @param {number} days - å¤©æ•¸
             */
            setDateRange(days) {
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - days);

                document.getElementById('startDate').value = Utils.formatDate(startDate);
                document.getElementById('endDate').value = Utils.formatDate(endDate);

                document.querySelectorAll('.quick-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event?.target.classList.add('active');

                const dateInfo = document.getElementById('dateInfo');
                dateInfo.innerHTML = `ğŸ“… æŸ¥è©¢ç¯„åœï¼š<span>${days}</span> å¤© (${Utils.formatDate(startDate)} ~ ${Utils.formatDate(endDate)})`;
            }

            /**
             * é–‹å§‹åˆ†æ
             */
            async startAnalysis() {
                const stockCode = document.getElementById('stockCode').value.trim();
                
                if (!Utils.validateStockCode(stockCode)) {
                    Utils.showToast('âš ï¸ è«‹è¼¸å…¥æœ‰æ•ˆçš„è‚¡ç¥¨ä»£è™Ÿï¼ˆ4-6ä½æ•¸å­—ï¼‰');
                    return;
                }

                const startDate = document.getElementById('startDate').value;
                const endDate = document.getElementById('endDate').value;

                if (!startDate || !endDate) {
                    Utils.showToast('âš ï¸ è«‹é¸æ“‡æ—¥æœŸç¯„åœ');
                    return;
                }

                await this.fetchAndAnalyze(stockCode, this.selectedMarket, startDate, endDate);
            }

            /**
             * å¾è‡ªé¸è‚¡åˆ†æ
             * @param {string} code - è‚¡ç¥¨ä»£è™Ÿ
             * @param {string} market - å¸‚å ´
             */
            async analyzeFromWatchlist(code, market) {
                document.getElementById('stockCode').value = code;
                this.selectMarket(market);
                
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 60);

                await this.fetchAndAnalyze(code, market, Utils.formatDate(startDate), Utils.formatDate(endDate));
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            /**
             * ç²å–ä¸¦åˆ†æè‚¡ç¥¨è³‡æ–™
             * @param {string} code - è‚¡ç¥¨ä»£è™Ÿ
             * @param {string} market - å¸‚å ´
             * @param {string} startDate - èµ·å§‹æ—¥æœŸ
             * @param {string} endDate - çµ‚æ­¢æ—¥æœŸ
             */
            async fetchAndAnalyze(code, market, startDate, endDate) {
                this.showLoading(true, 'æ­£åœ¨ç²å–è‚¡ç¥¨è³‡æ–™...');
                this.hideError();
                document.getElementById('results').classList.remove('active');

                try {
                    // ç²å–è‚¡ç¥¨è³‡æ–™
                    const data = await this.fetchStockData(code, market, startDate, endDate);
                    
                    if (!data || data.length === 0) {
                        throw new Error('æŸ¥ç„¡è³‡æ–™ï¼Œè«‹ç¢ºèªè‚¡ç¥¨ä»£è™Ÿèˆ‡æ—¥æœŸç¯„åœ');
                    }

                    this.stockData = data;
                    this.showLoading(true, 'æ­£åœ¨è¨ˆç®—æŠ€è¡“æŒ‡æ¨™...');

                    // è¨ˆç®—æŠ€è¡“æŒ‡æ¨™
                    this.indicators = this.calculateIndicators(data);

                    this.showLoading(true, 'æ­£åœ¨ç”Ÿæˆåˆ†æå ±å‘Š...');

                    // é¡¯ç¤ºçµæœ
                    this.displayResults(code, market, data, this.indicators);

                    Utils.showToast('âœ… åˆ†æå®Œæˆ');

                } catch (error) {
                    console.error('åˆ†æå¤±æ•—:', error);
                    this.showError(error.message);
                    Utils.showToast('âŒ ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }

            /**
             * ç²å–è‚¡ç¥¨è³‡æ–™
             * @param {string} code - è‚¡ç¥¨ä»£è™Ÿ
             * @param {string} market - å¸‚å ´
             * @param {string} startDate - èµ·å§‹æ—¥æœŸ
             * @param {string} endDate - çµ‚æ­¢æ—¥æœŸ
             * @returns {Promise<Array>} è‚¡ç¥¨è³‡æ–™é™£åˆ—
             */
            async fetchStockData(code, market, startDate, endDate) {
                const start = new Date(startDate);
                const end = new Date(endDate);

                if (market === 'twse') {
                    // è­‰äº¤æ‰€ API
                    const url = `https://www.twse.com.tw/exchangeReport/STOCK_DAY?response=json&date=${Utils.toROCDate(end)}&stockNo=${code}`;
                    const data = await this.networkManager.fetchWithProxy(url);

                    if (data.stat !== 'OK' || !data.data) {
                        throw new Error('æŸ¥ç„¡æ­¤è‚¡ç¥¨æˆ–è³‡æ–™ä¸å­˜åœ¨');
                    }

                    return data.data.map(row => ({
                        date: this.parseROCDate(row[0]),
                        volume: parseInt(row[1].replace(/,/g, '')) || 0,
                        open: parseFloat(row[3]) || 0,
                        high: parseFloat(row[4]) || 0,
                        low: parseFloat(row[5]) || 0,
                        close: parseFloat(row[6]) || 0,
                        change: parseFloat(row[7]) || 0
                    })).filter(d => {
                        const date = new Date(d.date);
                        return date >= start && date <= end;
                    });

                } else {
                    // ä¸Šæ«ƒä½¿ç”¨ Yahoo Finance
                    const timestamp1 = Math.floor(start.getTime() / 1000);
                    const timestamp2 = Math.floor(end.getTime() / 1000);
                    const url = `https://query1.finance.yahoo.com/v8/finance/chart/${code}.TWO?period1=${timestamp1}&period2=${timestamp2}&interval=1d`;
                    
                    const data = await this.networkManager.fetchWithProxy(url);

                    if (!data.chart || !data.chart.result || data.chart.result.length === 0) {
                        throw new Error('æŸ¥ç„¡æ­¤è‚¡ç¥¨æˆ–è³‡æ–™ä¸å­˜åœ¨');
                    }

                    const result = data.chart.result[0];
                    const timestamps = result.timestamp;
                    const quote = result.indicators.quote[0];

                    return timestamps.map((ts, i) => ({
                        date: new Date(ts * 1000).toISOString().split('T')[0],
                        open: quote.open[i] || 0,
                        high: quote.high[i] || 0,
                        low: quote.low[i] || 0,
                        close: quote.close[i] || 0,
                        volume: quote.volume[i] || 0,
                        change: i > 0 ? quote.close[i] - quote.close[i - 1] : 0
                    })).filter(d => d.close > 0);
                }
            }

            /**
             * è§£ææ°‘åœ‹å¹´æ—¥æœŸ
             * @param {string} rocDate - æ°‘åœ‹å¹´æ—¥æœŸå­—ä¸²
             * @returns {string} ISO æ—¥æœŸå­—ä¸²
             */
            parseROCDate(rocDate) {
                const parts = rocDate.split('/');
                const year = parseInt(parts[0]) + 1911;
                const month = parts[1].padStart(2, '0');
                const day = parts[2].padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            /**
             * è¨ˆç®—æ‰€æœ‰æŠ€è¡“æŒ‡æ¨™
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @returns {Object} æŠ€è¡“æŒ‡æ¨™ç‰©ä»¶
             */
            calculateIndicators(data) {
                const highs = data.map(d => d.high);
                const lows = data.map(d => d.low);
                const closes = data.map(d => d.close);

                return {
                    ma5: TechnicalIndicators.calculateMA(data, 5),
                    ma10: TechnicalIndicators.calculateMA(data, 10),
                    ma20: TechnicalIndicators.calculateMA(data, 20),
                    ma60: TechnicalIndicators.calculateMA(data, 60),
                    rsi: TechnicalIndicators.calculateRSI(data, 14),
                    kd: TechnicalIndicators.calculateKD(highs, lows, closes, 9),
                    macd: TechnicalIndicators.calculateMACD(data),
                    bollinger: TechnicalIndicators.calculateBollinger(data, 20, 2)
                };
            }

            /**
             * é¡¯ç¤ºåˆ†æçµæœ
             * @param {string} code - è‚¡ç¥¨ä»£è™Ÿ
             * @param {string} market - å¸‚å ´
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            displayResults(code, market, data, indicators) {
                const latest = data[data.length - 1];
                const prev = data[data.length - 2];

                // æ›´æ–°è‚¡ç¥¨æ¨™é¡Œ
                document.getElementById('stockName').textContent = code;
                document.getElementById('stockCodeDisplay').textContent = code;
                document.getElementById('marketTag').textContent = market === 'twse' ? 'ä¸Šå¸‚' : 'ä¸Šæ«ƒ';
                document.getElementById('marketTag').className = `market-tag ${market}`;
                document.getElementById('stockDate').textContent = `è³‡æ–™æ—¥æœŸ: ${latest.date}`;

                // æ›´æ–°åƒ¹æ ¼
                const priceClass = latest.change > 0 ? 'price-up' : latest.change < 0 ? 'price-down' : 'price-flat';
                document.getElementById('currentPrice').textContent = latest.close.toFixed(2);
                document.getElementById('currentPrice').className = `current-price ${priceClass}`;
                
                const changePercent = prev ? (latest.change / prev.close * 100) : 0;
                document.getElementById('priceChange').innerHTML = `
                    ${latest.change > 0 ? 'â–²' : latest.change < 0 ? 'â–¼' : 'â”€'} 
                    ${Math.abs(latest.change).toFixed(2)} 
                    (${changePercent > 0 ? '+' : ''}${changePercent.toFixed(2)}%)
                `;
                document.getElementById('priceChange').className = `price-change ${priceClass}`;

                // æ›´æ–°æŠ€è¡“æŒ‡æ¨™å¡ç‰‡
                this.updateOverviewCards(data, indicators);

                // æ›´æ–°é—œéµåƒ¹ä½
                this.updateKeyLevels(data, indicators);

                // ç¹ªè£½åœ–è¡¨
                this.renderCharts(data, indicators);

                // ç”Ÿæˆè­¦ç¤º
                this.generateAlerts(data, indicators);

                // ç”Ÿæˆ AI å ±å‘Š
                this.generateAIReport(code, data, indicators);

                // é¡¯ç¤ºçµæœå€åŸŸ
                document.getElementById('results').classList.add('active');
            }

            /**
             * æ›´æ–°æ¦‚è¦½å¡ç‰‡
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            updateOverviewCards(data, indicators) {
                const latest = data[data.length - 1];
                const rsi = indicators.rsi[indicators.rsi.length - 1];
                const k = indicators.kd.k[indicators.kd.k.length - 1];
                const d = indicators.kd.d[indicators.kd.d.length - 1];
                const macdOsc = indicators.macd.osc[indicators.macd.osc.length - 1];

                // æŠ€è¡“é¢è©•åˆ†
                let techScore = 50;
                if (rsi > 70) techScore -= 15;
                else if (rsi < 30) techScore += 15;
                if (k > d) techScore += 10;
                else techScore -= 10;
                if (macdOsc > 0) techScore += 15;
                else techScore -= 15;
                if (latest.close > indicators.ma20[indicators.ma20.length - 1]) techScore += 10;
                else techScore -= 10;

                techScore = Math.max(0, Math.min(100, techScore));

                document.getElementById('techScore').textContent = techScore.toFixed(0);
                document.getElementById('techProgress').style.width = techScore + '%';
                document.getElementById('techStatus').textContent = 
                    techScore >= 70 ? 'å¼·å‹¢' : techScore >= 50 ? 'ä¸­æ€§' : 'å¼±å‹¢';

                // RSI
                document.getElementById('rsiValue').textContent = rsi ? rsi.toFixed(2) : '-';
                document.getElementById('rsiSignal').textContent = 
                    rsi > 70 ? 'è¶…è²·' : rsi < 30 ? 'è¶…è³£' : 'ä¸­æ€§';

                // KD
                document.getElementById('kdValue').textContent = k ? `K:${k.toFixed(1)} D:${d.toFixed(1)}` : '-';
                document.getElementById('kdSignal').textContent = 
                    k > d ? 'å¤šé ­æ’åˆ—' : 'ç©ºé ­æ’åˆ—';

                // MACD
                document.getElementById('macdValue').textContent = macdOsc ? macdOsc.toFixed(3) : '-';
                document.getElementById('macdSignal').textContent = 
                    macdOsc > 0 ? 'å¤šé ­' : 'ç©ºé ­';

                // æˆäº¤é‡æ¯”
                const avgVolume = data.slice(-20).reduce((sum, d) => sum + d.volume, 0) / 20;
                const volumeRatio = latest.volume / avgVolume;
                document.getElementById('volumeRatio').textContent = volumeRatio.toFixed(2) + 'x';

                // æ³¢å‹•ç‡
                const returns = data.slice(-20).map((d, i, arr) => 
                    i > 0 ? (d.close - arr[i-1].close) / arr[i-1].close : 0
                );
                const volatility = Math.sqrt(returns.reduce((sum, r) => sum + r * r, 0) / returns.length) * 100;
                document.getElementById('volatility').textContent = volatility.toFixed(2) + '%';
            }

            /**
             * æ›´æ–°é—œéµåƒ¹ä½
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            updateKeyLevels(data, indicators) {
                const resistance = Math.max(...data.slice(-20).map(d => d.high));
                const support = Math.min(...data.slice(-20).map(d => d.low));

                document.getElementById('resistance').textContent = resistance.toFixed(2);
                document.getElementById('support').textContent = support.toFixed(2);
                document.getElementById('ma5').textContent = 
                    indicators.ma5[indicators.ma5.length - 1]?.toFixed(2) || '-';
                document.getElementById('ma20').textContent = 
                    indicators.ma20[indicators.ma20.length - 1]?.toFixed(2) || '-';
            }

            /**
             * æ¸²æŸ“æ‰€æœ‰åœ–è¡¨
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            renderCharts(data, indicators) {
                this.renderPriceChart(data, indicators);
                this.renderKDChart(data, indicators);
                this.renderMACDChart(data, indicators);
                this.renderTechnicalTable(data, indicators);
            }

            /**
             * æ¸²æŸ“åƒ¹æ ¼åœ–è¡¨
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            renderPriceChart(data, indicators) {
                const ctx = document.getElementById('priceChart');
                
                if (this.charts.price) {
                    this.charts.price.destroy();
                }

                this.charts.price = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.date),
                        datasets: [
                            {
                                label: 'æ”¶ç›¤åƒ¹',
                                data: data.map(d => d.close),
                                borderColor: '#3b82f6',
                                backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: true
                            },
                            {
                                label: 'MA5',
                                data: indicators.ma5,
                                borderColor: '#f59e0b',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: false
                            },
                            {
                                label: 'MA10',
                                data: indicators.ma10,
                                borderColor: '#8b5cf6',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: false
                            },
                            {
                                label: 'MA20',
                                data: indicators.ma20,
                                borderColor: '#10b981',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'index',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                display: false
                            },
                            tooltip: {
                                backgroundColor: 'rgba(30, 41, 54, 0.95)',
                                titleColor: '#f1f5f9',
                                bodyColor: '#94a3b8',
                                borderColor: '#2d3a4f',
                                borderWidth: 1
                            }
                        },
                        scales: {
                            x: {
                                grid: {
                                    color: '#2d3a4f'
                                },
                                ticks: {
                                    color: '#94a3b8',
                                    maxTicksLimit: 10
                                }
                            },
                            y: {
                                grid: {
                                    color: '#2d3a4f'
                                },
                                ticks: {
                                    color: '#94a3b8'
                                }
                            }
                        }
                    }
                });
            }

            /**
             * æ¸²æŸ“ KD åœ–è¡¨
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            renderKDChart(data, indicators) {
                const ctx = document.getElementById('kdChart');
                
                if (this.charts.kd) {
                    this.charts.kd.destroy();
                }

                this.charts.kd = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.date),
                        datasets: [
                            {
                                label: 'K',
                                data: indicators.kd.k,
                                borderColor: '#3b82f6',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: false
                            },
                            {
                                label: 'D',
                                data: indicators.kd.d,
                                borderColor: '#f59e0b',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: false
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: {
                                    color: '#94a3b8'
                                }
                            },
                            annotation: {
                                annotations: {
                                    line1: {
                                        type: 'line',
                                        yMin: 80,
                                        yMax: 80,
                                        borderColor: '#ef4444',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    },
                                    line2: {
                                        type: 'line',
                                        yMin: 20,
                                        yMax: 20,
                                        borderColor: '#10b981',
                                        borderWidth: 1,
                                        borderDash: [5, 5]
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: '#2d3a4f' },
                                ticks: { color: '#94a3b8', maxTicksLimit: 10 }
                            },
                            y: {
                                min: 0,
                                max: 100,
                                grid: { color: '#2d3a4f' },
                                ticks: { color: '#94a3b8' }
                            }
                        }
                    }
                });
            }

            /**
             * æ¸²æŸ“ MACD åœ–è¡¨
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            renderMACDChart(data, indicators) {
                const ctx = document.getElementById('macdChart');
                
                if (this.charts.macd) {
                    this.charts.macd.destroy();
                }

                this.charts.macd = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.map(d => d.date),
                        datasets: [
                            {
                                type: 'line',
                                label: 'DIF',
                                data: indicators.macd.dif,
                                borderColor: '#3b82f6',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: false,
                                yAxisID: 'y'
                            },
                            {
                                type: 'line',
                                label: 'MACD',
                                data: indicators.macd.macd,
                                borderColor: '#f59e0b',
                                borderWidth: 2,
                                tension: 0.1,
                                fill: false,
                                yAxisID: 'y'
                            },
                            {
                                type: 'bar',
                                label: 'OSC',
                                data: indicators.macd.osc,
                                backgroundColor: indicators.macd.osc.map(v => 
                                    v > 0 ? 'rgba(16, 185, 129, 0.5)' : 'rgba(239, 68, 68, 0.5)'
                                ),
                                yAxisID: 'y'
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#94a3b8' }
                            }
                        },
                        scales: {
                            x: {
                                grid: { color: '#2d3a4f' },
                                ticks: { color: '#94a3b8', maxTicksLimit: 10 }
                            },
                            y: {
                                grid: { color: '#2d3a4f' },
                                ticks: { color: '#94a3b8' }
                            }
                        }
                    }
                });
            }

            /**
             * æ¸²æŸ“æŠ€è¡“æ•¸æ“šè¡¨
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            renderTechnicalTable(data, indicators) {
                const tbody = document.getElementById('technicalBody');
                const rows = data.slice(-20).reverse().map((d, i) => {
                    const idx = data.length - 1 - i;
                    const changeClass = d.change > 0 ? 'price-up' : d.change < 0 ? 'price-down' : 'price-flat';
                    
                    return `
                        <tr>
                            <td>${d.date}</td>
                            <td class="${changeClass}">${d.close.toFixed(2)}</td>
                            <td class="${changeClass}">${d.change > 0 ? '+' : ''}${d.change.toFixed(2)}</td>
                            <td>${Utils.formatVolume(d.volume)}</td>
                            <td>${indicators.ma5[idx]?.toFixed(2) || '-'}</td>
                            <td>${indicators.ma10[idx]?.toFixed(2) || '-'}</td>
                            <td>${indicators.ma20[idx]?.toFixed(2) || '-'}</td>
                            <td>${indicators.rsi[idx]?.toFixed(2) || '-'}</td>
                            <td>${indicators.kd.k[idx]?.toFixed(2) || '-'}</td>
                            <td>${indicators.kd.d[idx]?.toFixed(2) || '-'}</td>
                        </tr>
                    `;
                }).join('');

                tbody.innerHTML = rows;
            }

            /**
             * ç”Ÿæˆè­¦ç¤º
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            generateAlerts(data, indicators) {
                const alerts = AlertGenerator.generate(data, indicators);
                const score = AlertGenerator.calculateScore(alerts);

                // çµ±è¨ˆ
                const bullishCount = alerts.filter(a => a.type === 'bullish').length;
                const bearishCount = alerts.filter(a => a.type === 'bearish').length;
                const warningCount = alerts.filter(a => a.type === 'warning').length;

                document.getElementById('bullishCount').textContent = bullishCount;
                document.getElementById('bearishCount').textContent = bearishCount;
                document.getElementById('warningCount').textContent = warningCount;
                document.getElementById('alertScore').textContent = score;

                // æ¸²æŸ“è­¦ç¤ºåˆ—è¡¨
                const container = document.getElementById('alertsList');
                if (alerts.length === 0) {
                    container.innerHTML = '<div class="watchlist-empty">ç›®å‰æ²’æœ‰é‡è¦è­¦ç¤º</div>';
                    return;
                }

                container.innerHTML = alerts.map(alert => `
                    <div class="alert-item priority-${alert.priority}">
                        <span class="alert-icon">${alert.icon}</span>
                        <div class="alert-content">
                            <div class="alert-title">${Utils.sanitizeHTML(alert.title)}</div>
                            <div class="alert-desc">${Utils.sanitizeHTML(alert.desc)}</div>
                        </div>
                        <span class="alert-tag tag-${alert.type}">
                            ${alert.type === 'bullish' ? 'çœ‹æ¼²' : alert.type === 'bearish' ? 'çœ‹è·Œ' : 'è­¦å‘Š'}
                        </span>
                    </div>
                `).join('');
            }

            /**
             * ç”Ÿæˆ AI åˆ†æå ±å‘Š
             * @param {string} code - è‚¡ç¥¨ä»£è™Ÿ
             * @param {Array} data - è‚¡ç¥¨è³‡æ–™
             * @param {Object} indicators - æŠ€è¡“æŒ‡æ¨™
             */
            generateAIReport(code, data, indicators) {
                const latest = data[data.length - 1];
                const rsi = indicators.rsi[indicators.rsi.length - 1];
                const k = indicators.kd.k[indicators.kd.k.length - 1];
                const d = indicators.kd.d[indicators.kd.d.length - 1];
                const macdOsc = indicators.macd.osc[indicators.macd.osc.length - 1];

                let trend = 'ä¸­æ€§';
                if (latest.close > indicators.ma20[indicators.ma20.length - 1]) {
                    trend = 'å¤šé ­';
                } else if (latest.close < indicators.ma20[indicators.ma20.length - 1]) {
                    trend = 'ç©ºé ­';
                }

                const report = `
                    <div class="analysis-section">
                        <h4>ğŸ“Š æŠ€è¡“é¢åˆ†æç¸½çµ</h4>
                        <p><strong>è‚¡ç¥¨ä»£è™Ÿï¼š</strong>${code}</p>
                        <p><strong>æ”¶ç›¤åƒ¹ï¼š</strong>${latest.close.toFixed(2)} å…ƒ</p>
                        <p><strong>è¶¨å‹¢åˆ¤æ–·ï¼š</strong>${trend}è¶¨å‹¢</p>
                    </div>

                    <div class="analysis-section">
                        <h4>ğŸ“ˆ å‡ç·šåˆ†æ</h4>
                        <p>ç›®å‰è‚¡åƒ¹ä½æ–¼ MA20 ${latest.close > indicators.ma20[indicators.ma20.length - 1] ? 'ä¸Šæ–¹' : 'ä¸‹æ–¹'}ï¼Œ
                        ${indicators.ma5[indicators.ma5.length - 1] > indicators.ma20[indicators.ma20.length - 1] ? 
                            'çŸ­æœŸå‡ç·šå‘ˆç¾å¤šé ­æ’åˆ—' : 'çŸ­æœŸå‡ç·šå‘ˆç¾ç©ºé ­æ’åˆ—'}ã€‚</p>
                    </div>

                    <div class="analysis-section">
                        <h4>ğŸ“‰ æŠ€è¡“æŒ‡æ¨™è§£è®€</h4>
                        <ul>
                            <li><strong>RSI(14)ï¼š</strong>${rsi.toFixed(2)} - 
                                ${rsi > 70 ? 'è¶…è²·å€ï¼Œæ³¨æ„å›æª”é¢¨éšª' : 
                                  rsi < 30 ? 'è¶…è³£å€ï¼Œå¯èƒ½å‡ºç¾åå½ˆ' : 
                                  'ä¸­æ€§å€é–“ï¼Œç„¡æ˜é¡¯è¶…è²·è¶…è³£'}
                            </li>
                            <li><strong>KD æŒ‡æ¨™ï¼š</strong>K=${k.toFixed(2)}, D=${d.toFixed(2)} - 
                                ${k > d ? 'K ç·šåœ¨ D ç·šä¸Šæ–¹ï¼Œå‘ˆç¾å¤šé ­æ’åˆ—' : 'K ç·šåœ¨ D ç·šä¸‹æ–¹ï¼Œå‘ˆç¾ç©ºé ­æ’åˆ—'}
                            </li>
                            <li><strong>MACDï¼š</strong>${macdOsc > 0 ? 'æ­£å€¼' : 'è² å€¼'} - 
                                ${macdOsc > 0 ? 'å¤šé ­è¨Šè™Ÿï¼Œè¶¨å‹¢å‘ä¸Š' : 'ç©ºé ­è¨Šè™Ÿï¼Œè¶¨å‹¢å‘ä¸‹'}
                            </li>
                        </ul>
                    </div>

                    <div class="analysis-section">
                        <h4>ğŸ’¡ æ“ä½œå»ºè­°</h4>
                        <p>
                            ${trend === 'å¤šé ­' && rsi < 70 ? 
                                'ç›®å‰è™•æ–¼å¤šé ­è¶¨å‹¢ä¸”æœªè¶…è²·ï¼Œå¯è€ƒæ…®é€¢ä½å¸ƒå±€ã€‚' :
                              trend === 'å¤šé ­' && rsi > 70 ?
                                'é›–è™•å¤šé ­è¶¨å‹¢ä½†å·²è¶…è²·ï¼Œå»ºè­°ç­‰å¾…å›æª”å†é€²å ´ã€‚' :
                              trend === 'ç©ºé ­' && rsi > 30 ?
                                'ç›®å‰è™•æ–¼ç©ºé ­è¶¨å‹¢ï¼Œå»ºè­°è§€æœ›æˆ–ç­‰å¾…æ˜ç¢ºåè½‰è¨Šè™Ÿã€‚' :
                                'è™•æ–¼ç©ºé ­è¶¨å‹¢ä¸”è¶…è³£ï¼Œå¯èƒ½å‡ºç¾æŠ€è¡“æ€§åå½ˆï¼ŒçŸ­ç·šå¯ç•™æ„ã€‚'}
                        </p>
                        <p><strong>âš ï¸ é¢¨éšªæç¤ºï¼š</strong>æœ¬åˆ†æåƒ…ä¾›åƒè€ƒï¼ŒæŠ•è³‡å‰è«‹å¯©æ…è©•ä¼°è‡ªèº«é¢¨éšªæ‰¿å—èƒ½åŠ›ã€‚</p>
                    </div>
                `;

                document.getElementById('aiReportContent').innerHTML = report;
            }

            /**
             * è¤‡è£½å ±å‘Š
             */
            copyReport() {
                const reportContent = document.getElementById('aiReportContent').innerText;
                navigator.clipboard.writeText(reportContent).then(() => {
                    Utils.showToast('âœ… å ±å‘Šå·²è¤‡è£½åˆ°å‰ªè²¼ç°¿');
                }).catch(() => {
                    Utils.showToast('âŒ è¤‡è£½å¤±æ•—');
                });
            }

            /**
             * åŠ å…¥è‡ªé¸è‚¡
             */
            addToWatchlist() {
                const code = document.getElementById('stockCode').value.trim();
                if (!code) {
                    Utils.showToast('âš ï¸ è«‹å…ˆè¼¸å…¥è‚¡ç¥¨ä»£è™Ÿ');
                    return;
                }
                this.watchlistManager.add(code, this.selectedMarket);
            }

            /**
             * é¡¯ç¤º/éš±è—è¼‰å…¥å‹•ç•«
             * @param {boolean} show - æ˜¯å¦é¡¯ç¤º
             * @param {string} text - è¼‰å…¥æ–‡å­—
             */
            showLoading(show, text = 'æ­£åœ¨è¼‰å…¥...') {
                const loading = document.getElementById('loading');
                loading.classList.toggle('active', show);
                if (text) {
                    document.getElementById('loadingText').textContent = text;
                }
            }

            /**
             * é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯
             * @param {string} message - éŒ¯èª¤è¨Šæ¯
             */
            showError(message) {
                const errorEl = document.getElementById('errorMessage');
                errorEl.textContent = 'âŒ ' + message;
                errorEl.style.display = 'block';
            }

            /**
             * éš±è—éŒ¯èª¤è¨Šæ¯
             */
            hideError() {
                document.getElementById('errorMessage').style.display = 'none';
            }

            /**
             * åˆ‡æ›åˆ†é 
             * @param {string} tabId - åˆ†é  ID
             */
            showTab(tabId) {
                document.querySelectorAll('.tab-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.tab-content').forEach(content => {
                    content.classList.remove('active');
                });

                event.target.classList.add('active');
                document.getElementById('tab-' + tabId).classList.add('active');
            }
        }

        // ==================== æ‡‰ç”¨ç¨‹å¼å•Ÿå‹• ====================
        let app;
        
        document.addEventListener('DOMContentLoaded', () => {
            app = new StockAnalyzerApp();
            app.init();
            console.log('âœ… ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
        });
    </script>
</body>
</html>
      
